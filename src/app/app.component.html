<div class="root">
    <!-- <div class="input-json">
        <button>LOAD</button>
        <input type="text" [(ngModel)]="savedataJson">
    </div> -->
    <div class="character-template-select">
        <span class="actress">Actress:</span>
        <select [(ngModel)]="selectedCharacterTemplateIndex" (ngModelChange)="onCharacterTemplateChange()">
            <option *ngFor="let characterTemplate of characterTemplates;let i=index;" [value]="i">
                {{characterTemplate.name+'★'+characterTemplate.rare}}</option>
        </select>
        <button (click)="setCharacterTemplateToCharacter()">SET</button>
    </div>
    <div class="character" *ngIf="character">
        <div class="row">
            <table class="status-table">
                <tbody>
                    <tr>
                        <td>{{character.name+' ★'+character.rare}}</td>
                        <td></td>
                    </tr>
                    <tr class="level">
                        <td>Lv</td>
                        <td>
                            <div class="wrapper">
                                <input type="number" [(ngModel)]="character.level" [attr.min]="character.levelMin"
                                    [attr.max]="character.levelMax" (ngModelChange)="character.updateStatus()">
                                <span>{{character.levelMin}}</span>
                                <input type="range" [attr.min]="character.levelMin" [attr.max]="character.levelMax"
                                    [(ngModel)]="character.level" (ngModelChange)="character.updateStatus()">
                                <span>{{character.levelMax}}</span>
                            </div>
                        </td>
                    </tr>
                    <tr class="level">
                        <td>上限解放</td>
                        <td>
                            <div class="wrapper">
                                <input type="number" [disabled]="character.level!=character.levelMax" [attr.min]="0"
                                    [attr.max]="character.gradeUpLimit" [(ngModel)]="character.gradeUp"
                                    (ngModelChange)="character.updateStatus()">
                                <span>0</span>
                                <input type="range" [disabled]="character.level!=character.levelMax" [attr.min]="0"
                                    [attr.max]="character.gradeUpLimit" [(ngModel)]="character.gradeUp"
                                    (ngModelChange)="character.updateStatus()">
                                <span>{{character.gradeUpLimit}}</span>
                            </div>
                        </td>
                    </tr>
                    <tr class="hp">
                        <td>HP</td>
                        <td>
                            <!-- <div class="calc">(角色:{{character.hp}})</div> -->
                            <div class="warpper">{{character.hp}}</div>
                        </td>
                    </tr>
                    <tr class="shot-atk">
                        <td>射擊ATK</td>
                        <td>
                            <!-- <div class="calc"></div> -->
                            <div class="warpper">{{character.atkShot}}</div>
                        </td>
                    </tr>
                    <tr class="shot-attr">
                        <td>屬性值</td>
                        <td>
                            <!-- <div class="calc"></div> -->
                            <div class="warpper" [style.color]="character.WeaponShot.attrColor">
                                {{character.attrShot}}</div>
                        </td>
                    </tr>
                    <tr class="close-atk">
                        <td>近身ATK</td>
                        <td>
                            <!-- <div class="calc"></div> -->
                            <div class="warpper">{{character.atkClose}}</div>
                        </td>
                    </tr>
                    <tr class="close-attr">
                        <td>屬性值</td>
                        <td>
                            <!-- <div class="calc"></div> -->
                            <div class="warpper" [style.color]="character.WeaponClose.attrColor">{{character.attrClose}}
                            </div>
                        </td>
                    </tr>
                    <tr class="close-attr">
                        <td>DEF</td>
                        <td>
                            <!-- <div class="calc"></div> -->
                            <div class="warpper">{{character.def}}</div>
                        </td>
                    </tr>
                    <tr class="buff-list">
                        <td>Buff</td>
                        <td>
                            <div class="wrapper">
                                <div class="buff-list">
                                    <div class="buff" *ngFor="let buff of character.buffs">
                                        <select [(ngModel)]="buff.type" (ngModelChange)="character.updateStatus()">
                                            <option *ngFor="let attrType of attrTypeList" [value]="attrType.id">
                                                {{attrType.name}}
                                            </option>
                                        </select>
                                        <input type="number" class="value" [(ngModel)]="buff.valuePct"
                                            (ngModelChange)="character.updateStatus()">%
                                        <button (click)="deleteBuff(character.buffs,buff);
                                            character.updateStatus()">X</button>
                                    </div>
                                    <button class="new-buff" (click)="addBuff(character.buffs);
                                    character.updateStatus()">[+]</button>
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="row">
            <table class="unit weapon-shot">
                <tbody>
                    <tr>
                        <td>射擊</td>
                        <td></td>
                    </tr>
                    <tr class="atk">
                        <td>ATK</td>
                        <td>
                            <div class="wrapper">
                                <select [(ngModel)]="character.WeaponShot.base.unitType"
                                    (ngModelChange)="character.updateStatus()">
                                    <option *ngFor="let attrType of attrTypeGearShotList" [attr.value]="attrType.id">
                                        {{attrType.name}}
                                    </option>
                                </select>
                                <select [(ngModel)]="character.WeaponShot.base.atkAmmoTypeId"
                                    (ngModelChange)="character.updateStatus()">
                                    <option *ngFor="let attrType of attrTypeShotAmmoTypeList"
                                        [attr.value]="attrType.id">
                                        {{attrType.name}}
                                    </option>
                                </select>
                                <input type="number" [(ngModel)]="character.WeaponShot.base.atk"
                                    (ngModelChange)="character.updateStatus()">
                                <span>(Tune: {{character.WeaponShot.atk}})</span>
                            </div>
                        </td>
                    </tr>
                    <tr class="attr">
                        <td>屬性值</td>
                        <td>
                            <div class="wrapper">
                                <select [(ngModel)]="character.WeaponShot.base.attrTypeId"
                                    (ngModelChange)="character.updateStatus()">
                                    <option *ngFor="let attrType of attrTypeAttrList" [attr.value]="attrType.id">
                                        {{attrType.name}}
                                    </option>
                                </select>
                                <input type="number" [(ngModel)]="character.WeaponShot.base.attr"
                                    (ngModelChange)="character.updateStatus()">
                                <span [style.color]="character.WeaponShot.attrColor">(Tune:
                                    {{character.WeaponShot.attr}})</span>
                            </div>
                        </td>
                    </tr>
                    <tr class="buff-list">
                        <td>Buff</td>
                        <td>
                            <div class="wrapper">
                                <div class="buff-list">
                                    <div class="buff" *ngFor="let buff of character.WeaponShot.buffs">
                                        <select [(ngModel)]="buff.type">
                                            <option *ngFor="let attrType of attrTypeList" [attr.value]="attrType.id">
                                                {{attrType.name}}
                                            </option>
                                        </select>
                                        <input type="number" class="value" [(ngModel)]="buff.valuePct"
                                            (ngModelChange)="character.updateStatus()">%
                                        <button (click)="deleteBuff(character.WeaponShot.buffs,buff);
                                        character.updateStatus()">X</button>
                                    </div>
                                    <button class="new-buff" (click)="addBuff(character.WeaponShot.buffs);
                                    character.updateStatus()">[+]</button>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr class="tune-list">
                        <td>Tune</td>
                        <td>
                            <div class="wrapper">
                                <div class="buff-list">
                                    <div class="buff" *ngFor="let buff of character.WeaponShot.tunes">
                                        <select [(ngModel)]="buff.type">
                                            <option *ngFor="let attrType of attrTypeList" [attr.value]="attrType.id">
                                                {{attrType.name}}
                                            </option>
                                        </select>
                                        <input type="number" class="value" [(ngModel)]="buff.valuePct"
                                            (ngModelChange)="character.updateStatus()">%
                                        <button (click)="deleteBuff(character.WeaponShot.tunes,buff);
                                        character.updateStatus()">X</button>
                                    </div>
                                    <button class="new-buff" (click)="addBuff(character.WeaponShot.tunes);
                                    character.updateStatus()">[+]</button>
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="unit weapon-close">
                <tbody>
                    <tr>
                        <td>近身</td>
                        <td></td>
                    </tr>
                    <tr class="atk">
                        <td>ATK</td>
                        <td>
                            <div class="wrapper">
                                <select [(ngModel)]="character.WeaponClose.base.unitType"
                                    (ngModelChange)="character.updateStatus()">
                                    <option *ngFor="let attrType of attrTypeGearCloseList" [attr.value]="attrType.id">
                                        {{attrType.name}}
                                    </option>
                                </select>
                                <select [(ngModel)]="character.WeaponClose.base.atkAmmoTypeId"
                                    (ngModelChange)="character.updateStatus()">
                                    <option *ngFor="let attrType of attrTypeCloseHitTypeList"
                                        [attr.value]="attrType.id">
                                        {{attrType.name}}
                                    </option>
                                </select>
                                <input type="number" [(ngModel)]="character.WeaponClose.base.atk"
                                    (ngModelChange)="character.updateStatus()">
                                <span>(Tune: {{character.WeaponClose.atk}})</span>
                            </div>
                        </td>
                    </tr>
                    <tr class="attr">
                        <td>屬性值</td>
                        <td>
                            <div class="wrapper">
                                <select [(ngModel)]="character.WeaponClose.base.attrTypeId"
                                    (ngModelChange)="character.updateStatus()">
                                    <option *ngFor="let attrType of attrTypeAttrList" [attr.value]="attrType.id">
                                        {{attrType.name}}
                                    </option>
                                </select>
                                <input type="number" [(ngModel)]="character.WeaponClose.base.attr"
                                    (ngModelChange)="character.updateStatus()">
                                <span [style.color]="character.WeaponClose.attrColor">(Tune:
                                    {{character.WeaponClose.attr}})</span>
                            </div>
                        </td>
                    </tr>
                    <tr class="buff-list">
                        <td>Buff</td>
                        <td>
                            <div class="wrapper">
                                <div class="buff-list">
                                    <div class="buff" *ngFor="let buff of character.WeaponClose.buffs">
                                        <select [(ngModel)]="buff.type">
                                            <option *ngFor="let attrType of attrTypeList" [attr.value]="attrType.id">
                                                {{attrType.name}}
                                            </option>
                                        </select>
                                        <input type="number" class="value" [(ngModel)]="buff.valuePct"
                                            (ngModelChange)="character.updateStatus()">%
                                        <button (click)="deleteBuff(character.WeaponClose.buffs,buff);
                                        character.updateStatus()">X</button>
                                    </div>
                                    <button class="new-buff" (click)="addBuff(character.WeaponClose.buffs);
                                    character.updateStatus()">[+]</button>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr class="tune-list">
                        <td>Tune</td>
                        <td>
                            <div class="wrapper">
                                <div class="buff-list">
                                    <div class="buff" *ngFor="let buff of character.WeaponClose.tunes">
                                        <select [(ngModel)]="buff.type">
                                            <option *ngFor="let attrType of attrTypeList" [attr.value]="attrType.id">
                                                {{attrType.name}}
                                            </option>
                                        </select>
                                        <input type="number" class="value" [(ngModel)]="buff.valuePct"
                                            (ngModelChange)="character.updateStatus()">%
                                        <button (click)="deleteBuff(character.WeaponClose.tunes,buff);
                                        character.updateStatus()">X</button>
                                    </div>
                                    <button class="new-buff" (click)="addBuff(character.WeaponClose.tunes);
                                    character.updateStatus()">[+]</button>
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="unit equipment-top">
                <tbody>
                    <tr>
                        <td>上身</td>
                        <td></td>
                    </tr>
                    <tr class="hp">
                        <td>HP</td>
                        <td>
                            <div class="wrapper">
                                <input type="number" [(ngModel)]="character.EquipmentTop.base.hp">
                                <span>(Tune: {{character.EquipmentTop.hp}})</span>
                            </div>
                        </td>
                    </tr>
                    <tr class="def">
                        <td>DEF</td>
                        <td>
                            <div class="wrapper">
                                <input type="number" [(ngModel)]="character.EquipmentTop.base.def">
                                <span>(Tune: {{character.EquipmentTop.def}})</span>
                            </div>
                        </td>
                    </tr>
                    <tr class="buff-list">
                        <td>Buff</td>
                        <td>
                            <div class="wrapper">
                                <div class="buff-list">
                                    <div class="buff" *ngFor="let buff of character.EquipmentTop.buffs">
                                        <select [(ngModel)]="buff.type">
                                            <option *ngFor="let attrType of attrTypeList" [attr.value]="attrType.id">
                                                {{attrType.name}}
                                            </option>
                                        </select>
                                        <input type="number" class="value" [(ngModel)]="buff.valuePct"
                                            (ngModelChange)="character.updateStatus()">%
                                        <button (click)="deleteBuff(character.EquipmentTop.buffs,buff);
                                        character.updateStatus()">X</button>
                                    </div>
                                    <button class="new-buff" (click)="addBuff(character.EquipmentTop.buffs);
                                        character.updateStatus()">[+]</button>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr class="tune-list">
                        <td>Tune</td>
                        <td>
                            <div class="wrapper">
                                <div class="buff-list">
                                    <div class="buff" *ngFor="let buff of character.EquipmentTop.tunes">
                                        <select [(ngModel)]="buff.type">
                                            <option *ngFor="let attrType of attrTypeList" [attr.value]="attrType.id">
                                                {{attrType.name}}
                                            </option>
                                        </select>
                                        <input type="number" class="value" [(ngModel)]="buff.valuePct"
                                            (ngModelChange)="character.updateStatus()">%
                                        <button (click)="deleteBuff(character.EquipmentTop.tunes,buff);
                                        character.updateStatus()">X</button>
                                    </div>
                                    <button class="new-buff" (click)="addBuff(character.EquipmentTop.tunes);
                                        character.updateStatus()">[+]</button>
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="unit equipment-bottom">
                <tbody>
                    <tr>
                        <td>下身</td>
                        <td></td>
                    </tr>
                    <tr class="hp">
                        <td>HP</td>
                        <td>
                            <div class="wrapper">
                                <input type="number" [(ngModel)]="character.EquipmentBottom.base.hp">
                                <span>(Tune: {{character.EquipmentBottom.hp}})</span>
                            </div>
                        </td>
                    </tr>
                    <tr class="def">
                        <td>DEF</td>
                        <td>
                            <div class="wrapper">
                                <input type="number" [(ngModel)]="character.EquipmentBottom.base.def">
                                <span>(Tune: {{character.EquipmentBottom.def}})</span>
                            </div>
                        </td>
                    </tr>
                    <tr class="buff-list">
                        <td>Buff</td>
                        <td>
                            <div class="wrapper">
                                <div class="buff-list">
                                    <div class="buff" *ngFor="let buff of character.EquipmentBottom.buffs">
                                        <select [(ngModel)]="buff.type">
                                            <option *ngFor="let attrType of attrTypeList" [attr.value]="attrType.id">
                                                {{attrType.name}}
                                            </option>
                                        </select>
                                        <input type="number" class="value" [(ngModel)]="buff.valuePct"
                                            (ngModelChange)="character.updateStatus()">%
                                        <button (click)="deleteBuff(character.EquipmentBottom.buffs,buff);
                                        character.updateStatus()">X</button>
                                    </div>
                                    <button class="new-buff" (click)="addBuff(character.EquipmentBottom.buffs);
                                        character.updateStatus()">[+]</button>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr class="tune-list">
                        <td>Tune</td>
                        <td>
                            <div class="wrapper">
                                <div class="buff-list">
                                    <div class="buff" *ngFor="let buff of character.EquipmentBottom.tunes">
                                        <select [(ngModel)]="buff.type">
                                            <option *ngFor="let attrType of attrTypeList" [attr.value]="attrType.id">
                                                {{attrType.name}}
                                            </option>
                                        </select>
                                        <input type="number" class="value" [(ngModel)]="buff.valuePct"
                                            (ngModelChange)="character.updateStatus()">%
                                        <button (click)="deleteBuff(character.EquipmentBottom.tunes,buff);
                                        character.updateStatus()">X</button>
                                    </div>
                                    <button class="new-buff" (click)="addBuff(character.EquipmentBottom.tunes);
                                        character.updateStatus()">[+]</button>
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>